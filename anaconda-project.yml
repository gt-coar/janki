# TODO: replace/derive with doit

name: janki

commands:
  lab:
    unix: jupyter lab --no-browser --debug
    env_spec: default

env_specs:
  default:
    inherit_from:
      - anki
      - build
      - utest
      - atest
      - lint
      - dev
      - run
    channels:
      - conda-forge
      - nodefaults

  run:
    packages:
      - ipywidgets
      - jupyterlab >=3,<4
      - pyld
      - pyshacl
      - sqlalchemy >=1.3,<1.4
      - toml
      - zipp
      - pydantic

  dev:
    packages:
      - jupyterlab-gt-coar-theme
      - pip
      - jupyterlab-tour

  lint:
    packages:
      - black
      - isort
      - pylint
      - mypy

  build:
    inherit_from:
      - alchemyjsonschema
    packages:
      - diffoscope
      - genson
      - json-e
      - nodejs >=12,!=13.*,<15
      - pip
      - sqlacodegen
      - twine
      - wheel
      - pip:
        - pydantic-sqlalchemy

  utest:
    packages:
      - pytest-cov
      - hypothesis-jsonschema

  atest:
    packages:
      - firefox =78
      - robotframework-jupyterlibrary
      - geckodriver

  alchemyjsonschema:
    packages:
      - jsonschema
      - strict-rfc3339
      - isodate
      - pytz
      - pip:
        - alchemyjsonschema
        - magicalimport
        - dictknife >=0.7.2
  anki:
    packages:
      # anki only has 3.8 wheels
      - python >=3.8,<3.9
      - beautifulsoup4
      - black
      - decorator
      - distro
      - flask
      - flask-cors
      - isort
      - jsonschema
      - markdown
      - mock
      - mypy
      - mypy-protobuf
      - orjson
      - pip-tools
      - protobuf
      - pylint
      - pytest
      - requests
      - send2trash
      - snakeviz
      - stringcase
      - waitress>=2.0.0b1
      - pip:
        - fluent.syntax
        - compare-locales
        - anki